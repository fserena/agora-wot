@prefix owl: <http://www.w3.org/2002/07/owl#> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix xml: <http://www.w3.org/XML/1998/namespace> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix foaf: <http://xmlns.com/foaf/0.1/> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix librairy: <http://drinventor.dia.fi.upm.es/vocabulary#> .
@prefix wot: <http://iot.linkeddata.es/def/wot#> .
@prefix map: <http://iot.linkeddata.es/def/wot-mappings#> .
@prefix core: <http://iot.linkeddata.es/def/core#> .


_:ted1 a core:ThingEcosystemDescription ;
    core:describes _:eco .

_:eco a core:Ecosystem ;
    core:hasComponent _:ds, _:ts .

_:ds a librairy:DocumentService .
_:ts a librairy:TopicService .

_:td_ds a wot:ThingDescription ;
    wot:identifier "ds" ;      
    wot:describes _:ds ;
    map:hasAccessMapping [
        a map:AccessMapping ;
        map:mapsResourcesFrom [
            a wot:Endpoint ;
            wot:href "http://drinventor.dia.fi.upm.es/api/0.2/documents"^^xsd:anyURI ;
            wot:mediaType "application/json"
        ] ;
        map:hasMapping _:exposes_doc_map
    ] .

_:exposes_doc_map a map:Mapping ;
    map:key "exposes" ;
    map:predicate librairy:exposesDocument ;
    map:valuesTransformedBy _:td_doc .

_:td_doc a wot:ThingDescription ;
    wot:identifier "doc" ;
    wot:describes [
        a librairy:Document ;
        librairy:hasTopicDeals _:deal_container
    ] ;
    map:hasAccessMapping [
        a map:AccessMapping ;
        map:mapsResourcesFrom [
            a wot:Endpoint ;
            wot:href "http://drinventor.dia.fi.upm.es/api/0.2/documents/{{lslug($item)}}" ;
            wot:mediaType "application/json"
        ] ;
        map:hasMapping _:title_map , _:creation_map
    ] .

_:title_map a map:Mapping ;
    map:key "title" ;
    map:predicate librairy:title .

_:creation_map a map:Mapping ;
    map:key "creationTime" ;
    map:predicate librairy:creationTime .

_:td_deal_container a wot:ThingDescription ;
    wot:identifier "dcontainer" ;
    wot:describes _:deal_container ;
    map:hasAccessMapping [
        a map:AccessMapping ;
        map:mapsResourcesFrom [
            a wot:Endpoint ;
            wot:href "http://drinventor.dia.fi.upm.es/api/0.2/documents/{{lslug($item)}}/topics" ;
            wot:mediaType "application/json"
        ] ;
        map:hasMapping _:deal_map
    ] .

_:deal_container a librairy:TopicDealContainer .

_:deal_map a map:Mapping ;
    map:key "deals" ;
    map:predicate librairy:contains ;
    map:valuesTransformedBy _:td_deal .

_:td_deal a wot:ThingDescription ;
    wot:identifier "deal" ;
    wot:describes [
        a librairy:TopicDeal ;
        librairy:forTopic _:topic
    ] ;
    map:hasAccessMapping [
        a map:AccessMapping ;
        map:mapsResourcesFrom [
            a wot:Endpoint ;
            wot:href "http://drinventor.dia.fi.upm.es/api/0.2/documents/{{lslug($parent)}}/topics/{{lslug($item)}}" ;
            wot:mediaType "application/json"
        ] ;
        map:hasMapping _:weight_map
    ] .

_:weight_map a map:Mapping ;
    map:key "weight" ;
    map:predicate librairy:weight .

_:td_topic a wot:ThingDescription ;
    wot:identifier "topic" ;
    wot:describes _:topic ;
    map:hasAccessMapping [
        a map:AccessMapping ;
        map:mapsResourcesFrom [
            a wot:Endpoint ;
            wot:href "http://drinventor.dia.fi.upm.es/api/0.2/topics/{{lslug($item)}}" ;
            wot:mediaType "application/json"
        ] ;
        map:hasMapping _:creation_map, _:content_map
    ] .

_:topic a librairy:Topic .

_:content_map a map:Mapping ;
    map:key "content" ;
    map:predicate librairy:content .

_:td_ts a wot:ThingDescription ;
    wot:identifier "ts" ;
    wot:describes _:ts ;
    map:hasAccessMapping [
        a map:AccessMapping ;
        map:mapsResourcesFrom [
            a wot:Endpoint ;
            wot:href "http://drinventor.dia.fi.upm.es/api/0.2/topics"^^xsd:anyURI ;
            wot:mediaType "application/json"
        ] ;
        map:hasMapping _:exposes_topic_map
    ] .

_:exposes_topic_map a map:Mapping ;
    map:key "exposes" ;
    map:predicate librairy:exposesTopic ;
    map:valuesTransformedBy _:td_topic .
